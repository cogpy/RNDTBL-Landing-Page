/*
 * RNDTBL Core Types Specification (Z++)
 * Defines fundamental data types and structures for the RNDTBL platform
 */

// ============================================================================
// Basic Types
// ============================================================================

// Universally Unique Identifier
ID ::= String
  where
    âˆ€ id : ID â€¢ length(id) = 36 âˆ§ isUUID(id)

// Timestamp in ISO 8601 format
Timestamp ::= String
  where
    âˆ€ t : Timestamp â€¢ isISO8601(t)

// Content types
ContentType ::= text | markdown | html | json | code

// User identifier
UserID ::= ID

// Node identifier  
NodeID ::= ID

// Edge identifier
EdgeID ::= ID

// Topic identifier
TopicID ::= ID

// ============================================================================
// Content Structure
// ============================================================================

class Content
  type : ContentType
  data : String
  encoding : String
  size : â„•
  hash : String
  
  invariant
    size = length(data)
    hash = sha256(data)
end Content

// ============================================================================
// Metadata
// ============================================================================

class Metadata
  created : Timestamp
  modified : Timestamp
  author : UserID
  contributors : â„™ UserID
  version : â„•
  tags : â„™ String
  
  invariant
    author âˆˆ contributors
    created â‰¤ modified
    version â‰¥ 1
    
  init
    version = 1
    contributors = {author}
end Metadata

// ============================================================================
// Position (for UI layout)
// ============================================================================

class Position
  x : â„
  y : â„
  z : â„
  
  invariant
    true  // No restrictions on position values
end Position

// ============================================================================
// Visibility
// ============================================================================

VisibilityType ::= public | private | restricted

class Visibility
  type : VisibilityType
  allowedUsers : â„™ UserID
  allowedGroups : â„™ ID
  
  invariant
    type = public â‡’ allowedUsers = âˆ… âˆ§ allowedGroups = âˆ…
    type = private â‡’ |allowedUsers| = 1
    type = restricted â‡’ |allowedUsers| > 0 âˆ¨ |allowedGroups| > 0
end Visibility

// ============================================================================
// Link Types
// ============================================================================

LinkType ::= 
  | relatesTo       // General relationship
  | supports        // Supporting evidence
  | contradicts     // Contradicting evidence
  | dependsOn       // Dependency relationship
  | implements      // Implementation relationship
  | derives         // Derivation relationship
  | references      // Citation/reference
  | partOf          // Composition relationship
  | prerequisite    // Prerequisite relationship
  | alternative     // Alternative approach

// ============================================================================
// Change Types (for versioning)
// ============================================================================

ChangeType ::= 
  | create
  | update
  | delete
  | link
  | unlink
  | merge
  | split

class Change
  id : ID
  type : ChangeType
  timestamp : Timestamp
  user : UserID
  target : ID
  before : Content
  after : Content
  description : String
  
  invariant
    type = create â‡’ before = âŠ¥
    type = delete â‡’ after = âŠ¥
end Change

// ============================================================================
// Search Types
// ============================================================================

SearchOperator ::= and | or | not | near | exact

class SearchQuery
  terms : seq String
  operator : SearchOperator
  filters : â„™ Filter
  limit : â„•
  offset : â„•
  
  invariant
    limit > 0
    offset â‰¥ 0
end SearchQuery

class Filter
  field : String
  operator : ComparisonOperator
  value : String
end Filter

ComparisonOperator ::= eq | ne | gt | lt | ge | le | in | contains

// ============================================================================
// Result Types
// ============================================================================

class Result[T]
  success : ğ”¹
  data : T
  error : String
  
  invariant
    success â‡’ error = ""
    Â¬success â‡’ data = âŠ¥
end Result

class PagedResult[T]
  items : seq T
  total : â„•
  page : â„•
  pageSize : â„•
  hasNext : ğ”¹
  
  invariant
    |items| â‰¤ pageSize
    hasNext â‡” page * pageSize < total
    page â‰¥ 0
    pageSize > 0
end PagedResult

// ============================================================================
// Validation
// ============================================================================

class ValidationError
  field : String
  message : String
  code : String
end ValidationError

class ValidationResult
  valid : ğ”¹
  errors : seq ValidationError
  
  invariant
    valid â‡” errors = âŸ¨âŸ©
end ValidationResult

// ============================================================================
// Configuration
// ============================================================================

class SystemConfig
  maxNodeSize : â„•
  maxEdgesPerNode : â„•
  maxDepth : â„•
  enableVersioning : ğ”¹
  enableEncryption : ğ”¹
  
  invariant
    maxNodeSize > 0
    maxEdgesPerNode > 0
    maxDepth > 0
end SystemConfig

// Default configuration
defaultConfig : SystemConfig
defaultConfig.maxNodeSize = 1048576      // 1MB
defaultConfig.maxEdgesPerNode = 1000
defaultConfig.maxDepth = 100
defaultConfig.enableVersioning = true
defaultConfig.enableEncryption = false
